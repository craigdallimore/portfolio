module.exports = function(grunt) {

    grunt.registerMultiTask('undertmpl', 'html-tmpl -> JS', function() {
        this.files.forEach(function(f) {

            var output = 'App.module("Tmpl", function(Tmpl, App) {\n';

            f.src.map(function toJS(filePath) {
                var underTmpl = grunt.file.read(filePath),
                    jsTmpl = '    Tmpl.' + filePath.replace('./static/templates/', '')
                                                    .replace('.html', '');
                jsTmpl += '=';
                jsTmpl += grunt.util._.template(underTmpl).source.replace(/(\n|\t|\\n|\\t)/gi, '').replace(/\s+/gi, ' ');
                jsTmpl += ';\n';
                output += jsTmpl;
            });

            output += '});';
            grunt.file.write(f.dest, output);

        });
    });

};
